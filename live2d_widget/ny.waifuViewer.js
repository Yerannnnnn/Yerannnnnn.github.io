"use strict";function _classCallCheck(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,i){for(var a=0;a<i.length;a++){var t=i[a];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}function _createClass(e,i,a){return i&&_defineProperties(e.prototype,i),a&&_defineProperties(e,a),e}var cdnPath="//cdn.jsdelivr.net/gh/Yerannnnnn/Yerannnnnn.github.io@master/live2d_api/model/",apiPath="https://yuanjiuzheng.com/live2d_api/get/?id=",charData={"mengxiang/sagiri":apiPath+"01-0","mengxiang/snow_miku":apiPath+"02-0","mengxiang/chino":apiPath+"03-0","Potion-Maker/Pio":apiPath+"04-20","Potion-Maker/Tia":apiPath+"05-0","HyperdimensionNeptunia/histoirenohover":apiPath+"06-0","HyperdimensionNeptunia/noireswim":apiPath+"06-1","HyperdimensionNeptunia/nepswim":apiPath+"06-2","HyperdimensionNeptunia/noir":apiPath+"06-3","HyperdimensionNeptunia/noir_santa":apiPath+"06-4","HyperdimensionNeptunia/blanc_normal":apiPath+"06-5","HyperdimensionNeptunia/blanc_swimwear":apiPath+"06-6","HyperdimensionNeptunia/vert_classic":apiPath+"06-7","HyperdimensionNeptunia/vert_normal":apiPath+"06-8","HyperdimensionNeptunia/vert_swimwear":apiPath+"06-9","HyperdimensionNeptunia/nepgear_extra":apiPath+"06-10","HyperdimensionNeptunia/nepgearswim":apiPath+"06-11","HyperdimensionNeptunia/histoire":apiPath+"06-12","mengxiang/bronya":apiPath+"07-0"};$(document).ready(function(){new Viewer(cdnPath)});var Viewer=function(){function n(i){var t=this;_classCallCheck(this,n),this.Canvas=$("canvas"),this.selectCharacter=$(".selectCharacter"),this.selectAnimation=$(".selectAnimation");var e="<option>Select</option>";for(var a in loadlive2d("live2d",charData["mengxiang/sagiri"],.5,i),charData)e+='<option value="'+charData[a]+'">'+a+"</option>";this.selectCharacter.html(e),this.selectCharacter.change(function(e){0==e.target.selectedIndex&&loadlive2d("live2d",charData.sagiri,.5,i),loadlive2d("live2d",e.target.value,.5,i)}),this.app=new PIXI.Application(1280,720,{backgroundColor:1087931}),this.Canvas.html(this.app.view),this.app.ticker.add(function(e){t.model&&(t.model.update(e),t.model.masks.update(t.app.renderer))}),window.onresize=function(e){void 0===e&&(e=null);var i=window.innerWidth,a=i/16*9;t.app.view.style.width=i+"px",t.app.view.style.height=a+"px",t.app.renderer.resize(i,a),t.model&&(t.model.position=new PIXI.Point(.5*i,.5*a),t.model.scale=new PIXI.Point(.06*t.model.position.x,.06*t.model.position.x),t.model.masks.resize(t.app.view.width,t.app.view.height))},this.isClick=!1,this.app.view.addEventListener("mousedown",function(e){t.isClick=!0}),this.app.view.addEventListener("mousemove",function(e){var i,a;t.isClick&&(t.isClick=!1,t.model&&(t.model.inDrag=!0)),t.model&&(i=t.model.position.x-e.offsetX,a=t.model.position.y-e.offsetY,t.model.pointerX=-i/t.app.view.height,t.model.pointerY=-a/t.app.view.width)}),this.app.view.addEventListener("mouseup",function(e){var i,a;t.model&&(t.isClick&&(t.isHit("TouchHead",e.offsetX,e.offsetY)?t.startAnimation("touch_head","base"):t.isHit("TouchSpecial",e.offsetX,e.offsetY)?t.startAnimation("touch_special","base"):(a=(i=["touch_body","main_1","main_2","main_3"])[Math.floor(Math.random()*i.length)],t.startAnimation(a,"base"))),t.isClick=!1,t.model.inDrag=!1)})}return _createClass(n,[{key:"changeCanvas",value:function(e){var n=this;this.app.stage.removeChildren(),this.selectAnimation.empty(),e.motions.forEach(function(e,i){var a,t;"effect"!=i&&(a=document.createElement("button"),t=document.createTextNode(i),a.appendChild(t),a.className="btn btn-secondary",a.addEventListener("click",function(){n.startAnimation(i,"base")}),n.selectAnimation.append(a))}),this.model=e,this.model.update=this.onUpdate,this.model.animator.addLayer("base",LIVE2DCUBISMFRAMEWORK.BuiltinAnimationBlenders.OVERRIDE,1),this.app.stage.addChild(this.model),this.app.stage.addChild(this.model.masks),window.onresize()}},{key:"onUpdate",value:function(e){var i,n=this,a=.016*e;this.animator.isPlaying||(i=this.motions.get("idle"),this.animator.getLayer("base").play(i)),this._animator.updateAndEvaluate(a),this.inDrag&&(this.addParameterValueById("ParamAngleX",30*this.pointerX),this.addParameterValueById("ParamAngleY",30*-this.pointerY),this.addParameterValueById("ParamBodyAngleX",10*this.pointerX),this.addParameterValueById("ParamBodyAngleY",10*-this.pointerY),this.addParameterValueById("ParamEyeBallX",this.pointerX),this.addParameterValueById("ParamEyeBallY",-this.pointerY)),this._physicsRig&&this._physicsRig.updateAndEvaluate(a),this._coreModel.update();for(var t=!1,s=0;s<this._meshes.length;++s)this._meshes[s].alpha=this._coreModel.drawables.opacities[s],this._meshes[s].visible=Live2DCubismCore.Utils.hasIsVisibleBit(this._coreModel.drawables.dynamicFlags[s]),Live2DCubismCore.Utils.hasVertexPositionsDidChangeBit(this._coreModel.drawables.dynamicFlags[s])&&(this._meshes[s].vertices=this._coreModel.drawables.vertexPositions[s],this._meshes[s].dirtyVertex=!0),Live2DCubismCore.Utils.hasRenderOrderDidChangeBit(this._coreModel.drawables.dynamicFlags[s])&&(t=!0);t&&this.children.sort(function(e,i){var a=n._meshes.indexOf(e),t=n._meshes.indexOf(i);return n._coreModel.drawables.renderOrders[a]-n._coreModel.drawables.renderOrders[t]}),this._coreModel.drawables.resetDynamicFlags()}},{key:"startAnimation",value:function(e,i){var a,t;this.model&&(!(a=this.model.motions.get(e))||(t=this.model.animator.getLayer(i))&&t.play(a))}},{key:"isHit",value:function(e,i,a){if(!this.model)return!1;var t=this.model.getModelMeshById(e);if(!t)return!1;for(var n=t.vertices,s=n[0],r=n[0],o=n[1],d=n[1],l=1;l<4;++l){var h=n[0+2*l],p=n[0+2*l+1];h<s&&(s=h),r<h&&(r=h),p<o&&(o=p),d<p&&(d=p)}var m=t.worldTransform.tx-i,c=t.worldTransform.ty-a,u=-m/t.worldTransform.a,v=-c/t.worldTransform.d;return s<=u&&u<=r&&o<=v&&v<=d}}]),n}();